:root {
  --form-element-invalid-border-color: var(--color-invalid);
  --form-element-invalid-active-border-color: var(--color-invalid-active);
  --form-element-invalid-focus-color: var(--color-invalid-focus);
  --form-element-valid-border-color: var(--color-valid);
  --form-element-valid-active-border-color: var(--color-valid-active);
  --form-element-valid-focus-color: var(--color-valid-focus);
  --form-element-disabled-background-color: var(
    --color-form-element-disabled-background
  );
  --form-element-disabled-border-color: var(
    --color-form-element-disabled-border
  );
}

input:where(:not(:is([type="checkbox"], [type="radio"], [type="range"], [type="submit"], [type="reset"], [type="button"]))) {
  height: calc(
    (1rem * var(--line-height)) + (var(--spacing-form-element-vertical) * 2) +
      (var(--sizing-border-width) * 2)
  );
}

fieldset {
  margin: 0;
  margin-bottom: var(--spacing);
  padding: 0;
  border: 0;
}

label,
fieldset legend {
  display: block;
  margin-bottom: calc(var(--spacing) * 0.25);
  font-weight: var(--form-label-font-weight, var(--font-weight));
}

input:where(:not(:is([type="checkbox"], [type="radio"], [type="submit"], [type="reset"], [type="button"]))),
select,
textarea {
  width: 100%;
}

textarea {
  font-family: var(--font-family-monospace);
}

input:where(:not(:is([type="checkbox"], [type="radio"], [type="range"], [type="file"]))),
select,
textarea {
  appearance: none;
  padding: var(--form-element-spacing-vertical)
    var(--form-element-spacing-horizontal);
}

input,
select,
textarea {
  --background-color: var(--color-form-element-background);
  --border-color: var(--color-form-element-border);
  --color: var(--color-form-element-color);
  --box-shadow: none;
  border: var(--border-width) solid var(--border-color);
  border-radius: var(--sizing-border-radius);
  outline: none;
  background-color: var(--background-color);
  box-shadow: var(--box-shadow);
  color: var(--color);
  font-weight: var(--font-weight);
  transition: background-color var(--transition), border-color var(--transition),
    color var(--transition), box-shadow var(--transition);
}

:is(input:where(:not(:is([type="submit"], [type="button"], [type="reset"], [type="checkbox"], [type="radio"], [readonly]))), select, textarea):is(:active, :focus) {
  --background-color: var(--color-form-element-active-background);
  --border-color: var(--color-form-element-active-border);
}

:is(input:where(:not(:is([type="submit"], [type="button"], [type="reset"], [type="range"], [type="file"], [readonly]))), select, textarea):focus {
  --box-shadow: 0 0 0 var(--sizing-outline-width)
    var(--color-form-element-focus);
}

input[disabled]:where(:not(:is([type="submit"], [type="button"], [type="reset"]))),
select[disabled],
textarea[disabled],
:where(fieldset[disabled])
  :is(input:where(:not(:is([type="submit"], [type="button"], [type="reset"]))), select, textarea) {
  --background-color: var(--form-element-disabled-background-color);
  --border-color: var(--form-element-disabled-border-color);
  opacity: var(--form-element-disabled-opacity);
  pointer-events: none;
}

:is(input, select, textarea)[aria-invalid]:not(:is([type="checkbox"], [type="radio"])) {
  padding-right: calc(var(--spacing-form-element-horizontal) + 1.5rem);
  padding-left: var(--spacing-form-element-horizontal);
  padding-inline-start: var(--spacing-form-element-horizontal);
  padding-inline-end: calc(var(--spacing-form-element-horizontal) + 1.5rem);
  background-position: center right 0.75rem;
  background-size: 1rem auto;
  background-repeat: no-repeat;
}

:is(input, select, textarea)[aria-invalid="false"]:where(:not(:is([type="checkbox"], [type="radio"]))) {
  background-image: var(--icon-valid);
}

:is(input, select, textarea)[aria-invalid="true"]:where(:not(:is([type="checkbox"], [type="radio"]))) {
  background-image: var(--icon-invalid);
}

:is(input, select, textarea)[aria-invalid="false"] {
  --border-color: var(--form-element-valid-border-color);
}

:is(input, select, textarea)[aria-invalid="false"]:is(:active, :focus) {
  --border-color: var(--form-element-valid-active-border-color) !important;
  --box-shadow: 0 0 0 var(--outline-width) var(--form-element-valid-focus-color) !important;
}

:is(input, select, textarea)[aria-invalid="true"] {
  --border-color: var(--form-element-invalid-border-color);
}

:is(input, select, textarea)[aria-invalid="true"]:is(:active, :focus) {
  --border-color: var(--form-element-invalid-active-border-color) !important;
  --box-shadow: 0 0 0 var(--outline-width)
    var(--form-element-invalid-focus-color) !important;
}

[dir="rtl"]
  :is(input, select, textarea):is([aria-invalid], [aria-invalid="true"], [aria-invalid="false"]):where(:not(:is([type="checkbox"], [type="radio"]))) {
  background-position: center left 0.75rem;
}
